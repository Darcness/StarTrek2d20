import { FacialHairCategory, FacialHairType } from "./facialHairEnum";
import { DefaultLip } from "./mouthCatalog";
import SpeciesRestrictions from "./speciesRestrictions";
import Swatch from "./swatch";
import { Token } from "./token";


const SoulPatch = `<g>
    <path style="fill:#383838;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 306.75182,203.20646 c 0,0 1.47293,0.34607 2.94578,0.49531 1.47285,0.14924 4.43578,0.31628 5.89156,0.20855 1.45577,-0.10772 1.92705,-0.28338 2.81543,-0.52137 0.88838,-0.23799 2.50261,-0.88634 2.50261,-0.88634 l 0.78206,0.99061 0.88634,2.97185 -0.26069,2.0855 c 0,0 -0.74291,1.87209 -1.22523,2.50261 -0.48232,0.63052 -1.48593,1.30344 -1.48593,1.30344 l -1.51199,1.98123 c 0,0 -0.91804,1.08939 -1.40771,1.45986 -0.48967,0.37047 -1.45986,0.78206 -1.45986,0.78206 l -1.19916,-1.09489 c 0,0 -0.19348,-0.38408 -0.4171,-0.57351 -0.22362,-0.18943 -0.57124,-0.21702 -0.93848,-0.46924 -0.36724,-0.25222 -1.19917,-1.09489 -1.19917,-1.09489 0,0 -0.15399,-0.30177 -0.46924,-0.62565 -0.31525,-0.32388 -1.51199,-1.19917 -1.51199,-1.19917 l -1.19916,-1.40772 -0.10428,-0.57351 -1.12095,-0.70386 -1.17311,-1.85089 0.15642,-1.77268 z" id="path124628"/>
    <path id="path124611" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="M 321.27148 202.81641 C 321.27148 202.81641 322.02834 205.07295 322.1582 205.99609 C 322.28807 206.91924 322.18747 207.80636 322.05469 208.60352 C 321.92191 209.40067 320.95898 211.26172 320.95898 211.26172 C 320.95898 211.26172 322.53154 209.67275 322.88867 208.81055 C 323.24581 207.94835 323.25957 206.91136 322.99219 205.89062 C 322.7248 204.86988 321.27148 202.81641 321.27148 202.81641 z M 306.77734 203.28516 C 306.77734 203.28516 305.79592 204.50491 305.68359 205.31836 C 305.57126 206.13181 305.60505 207.26362 305.99609 207.97656 C 306.38713 208.6895 307.92578 209.38477 307.92578 209.38477 C 307.92578 209.38477 306.72611 208.34185 306.51758 207.66406 C 306.30905 206.98627 306.26829 206.26595 306.30859 205.52734 C 306.34891 204.78873 306.77734 203.28516 306.77734 203.28516 z M 319.61328 204.90234 C 319.61328 204.90234 320.06734 207.66903 320.08594 208.54297 C 320.10464 209.41691 320.14356 210.07433 320.03516 210.73438 C 319.92677 211.39442 319.49219 212.47266 319.49219 212.47266 C 319.49219 212.47266 320.35454 211.38687 320.55469 210.77148 C 320.75484 210.15609 321.068 209.8665 321.0293 208.50586 C 320.99063 207.14522 319.61328 204.90234 319.61328 204.90234 z M 315.01562 205.63086 C 315.01562 205.63086 315.35519 207.67341 315.48438 208.60352 C 315.61356 209.53362 315.73559 210.26672 315.74609 211.1582 C 315.7566 212.04968 315.64137 213.01603 315.53711 213.91992 C 315.43285 214.82381 315.17188 216.63281 315.17188 216.63281 C 315.17188 216.63281 315.84138 214.83567 316.05859 213.91992 C 316.2758 213.00417 316.47061 212.05407 316.47461 211.1582 C 316.47816 210.26233 316.34596 209.5323 316.11133 208.60352 C 315.8767 207.67473 315.01562 205.63086 315.01562 205.63086 z M 307.97656 205.73438 C 307.97656 205.73438 307.70231 207.74145 307.82031 208.56055 C 307.93826 209.37964 308.17573 210.12105 308.60352 210.8457 C 309.03131 211.57035 310.58398 212.4082 310.58398 212.4082 C 310.58398 212.4082 309.52318 211.24077 309.17578 210.54492 C 308.82838 209.84908 308.57373 208.97061 308.39453 208.19922 C 308.21533 207.42783 307.97656 205.73437 307.97656 205.73438 z M 318.30859 206.78906 C 318.30859 206.78906 318.35707 208.04008 318.38867 208.76953 C 318.42023 209.49898 318.60369 210.33556 318.49805 211.16602 C 318.3924 211.99647 318.04963 212.8746 317.72656 213.67383 C 317.4035 214.47307 316.57422 215.94727 316.57422 215.94727 C 316.57422 215.94727 318.00834 214.69335 318.47656 213.9375 C 318.94477 213.18166 319.24846 212.30169 319.35938 211.52539 C 319.47028 210.74909 319.37784 210.19197 319.21484 209.39258 C 319.05183 208.59319 318.30859 206.78906 318.30859 206.78906 z M 311.01172 208.78125 C 311.01172 208.78125 310.60917 210.49576 310.67383 211.21289 C 310.73843 211.93003 310.925 212.58946 311.30469 213.24805 C 311.68439 213.90663 313.17969 214.74609 313.17969 214.74609 C 313.17969 214.74609 312.19787 213.65698 311.89648 213.0293 C 311.59509 212.40162 311.39635 211.62381 311.26758 210.94336 C 311.13881 210.26291 311.01172 208.78125 311.01172 208.78125 z M 312.92383 210.04297 C 312.92383 210.04297 312.74864 211.764 312.85352 212.42578 C 312.95838 213.08756 312.99191 213.72165 313.3125 214.46484 C 313.63313 215.20801 314.9668 216.38086 314.9668 216.38086 C 314.9668 216.38086 314.15434 215.08525 313.94727 214.47656 C 313.74019 213.86787 313.54723 213.06152 313.37695 212.40039 C 313.20668 211.73925 312.92383 210.04297 312.92383 210.04297 z "/>
</g>`;

const BasicMoustache = `<g>
    <path style="fill:#383838;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 310.63608,177.47654 c 0.9275,-0.64926 2.87663,-0.75451 4.58811,-0.72993 1.71148,0.0246 4.59211,0.10205 5.52659,1.04275 0.93448,0.9407 0.12251,1.61937 0.4171,2.29406 0.29459,0.67469 0.38486,0.97477 1.25131,1.66841 0.86645,0.69364 2.69358,1.28302 4.17101,1.87695 1.47743,0.59393 3.44467,1.17016 4.69239,1.6684 1.24772,0.49824 2.21942,0.68177 2.81543,1.25131 0.59601,0.56954 0.56421,0.99155 0.8342,1.6684 0.26999,0.67685 0.56876,1.54235 0.72993,2.39833 0.16117,0.85598 0.34305,2.58789 0.20855,2.71116 -0.1345,0.12327 -2.11881,0.33518 -3.02398,0.4171 -0.90517,0.0819 -1.54393,0.13481 -2.39834,0.10428 -0.85441,-0.0305 -2.29405,-0.31283 -2.71115,-0.31283 -0.4171,0 -8.6458,-0.93161 -11.47028,-0.93848 -2.82448,-0.007 -3.48701,0.1309 -5.42232,0.41711 -1.93531,0.28621 -3.77084,0.95689 -6.15224,1.35557 -2.3814,0.39868 -5.52376,0.75203 -8.13347,0.93848 -2.60971,0.18645 -5.78848,-0.004 -7.50782,0.20855 -1.71934,0.21293 -2.19746,0.1561 -2.81544,0.62565 -0.61798,0.46955 -0.8342,1.56413 -0.8342,1.56413 -0.16333,0.0941 -1.04323,-0.77658 -1.45985,-1.45985 -0.41662,-0.68327 -0.86123,-1.66695 -0.83421,-2.60688 0.027,-0.93993 0.47613,-1.7982 1.04276,-2.71116 0.56663,-0.91296 0.94417,-1.57757 2.39833,-2.60688 1.45416,-1.02931 3.98208,-1.90453 6.56934,-2.81543 2.58726,-0.9109 6.62752,-1.74758 8.96768,-2.50261 2.34016,-0.75503 3.87329,-1.21078 5.10949,-1.87696 1.2362,-0.66618 1.83417,-1.13034 2.39833,-1.77268 0.56416,-0.64234 0.11525,-1.22769 1.04275,-1.87695 z" id="path129606"/>
    <path id="path128835" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="M 310.84375 177.16406 C 310.84375 177.16406 309.38998 178.92828 308.3418 179.66602 C 307.29362 180.40375 307.48794 180.31428 304.58789 181.43945 C 301.68784 182.56462 293.96637 184.30686 290.71875 185.71484 C 287.47113 187.12283 286.18917 187.65411 284.88086 189.05078 C 283.57255 190.44745 282.91072 191.97733 282.79492 193.32617 C 282.67912 194.67501 283.17839 195.80297 283.73242 196.55859 C 284.28645 197.31421 285.60938 197.81055 285.60938 197.81055 C 285.60938 197.81055 284.69064 196.89793 284.35938 196.14258 C 284.02811 195.38723 283.69747 194.46357 283.83789 193.32617 C 283.97831 192.18877 284.33143 190.91945 285.50586 189.67578 C 286.68029 188.43211 287.90307 188.05676 291.0332 186.75781 C 292.59985 186.10768 295.21042 185.37185 297.80664 184.64453 C 297.64886 184.84769 297.42926 185.14688 297.29492 185.4043 C 297.06797 185.83918 296.59375 187.43164 296.59375 187.43164 C 296.59375 187.43164 297.28883 186.00617 297.62695 185.51367 C 297.82708 185.22216 298.16506 184.79152 298.41797 184.47266 C 300.79498 183.80626 303.094 183.15161 304.48438 182.58594 C 307.50807 181.35574 308.35593 181.12158 309.38477 180.08398 C 310.4136 179.04639 310.84375 177.16406 310.84375 177.16406 z M 318.5293 177.58789 C 318.5293 177.58789 318.6195 179.12216 318.82422 179.68945 C 319.029 180.25674 319.15287 180.70896 319.5625 181.08984 C 319.97213 181.47072 321.07422 182.30664 321.07422 182.30664 C 321.07422 182.30664 320.23993 181.30861 319.89453 180.90625 C 319.54913 180.50389 319.43877 180.02922 319.19336 179.50391 C 318.94795 178.9786 318.5293 177.58789 318.5293 177.58789 z M 320.33398 177.68555 C 320.33398 177.68555 320.87448 181.30369 322.52344 182.37695 C 324.1724 183.45021 326.6322 184.4656 328.4668 185.19336 C 329.59917 185.64255 330.53052 185.82879 331.4668 186.14258 C 331.82114 186.80412 332.63008 188.34153 332.79688 188.86914 C 333.01027 189.54417 333.30856 190.22329 333.34961 190.78516 C 333.39061 191.34703 333.30924 192.11245 333.27734 192.62891 C 333.24564 193.14537 333.12891 194.10352 333.12891 194.10352 C 333.12891 194.10352 333.46716 193.08681 333.57227 192.55664 C 333.67738 192.02647 333.80702 191.28988 333.79297 190.71289 C 333.77897 190.1359 333.52207 189.40113 333.24023 188.7207 C 333.02938 188.21164 332.03948 186.83542 331.55469 186.17383 C 332.10636 186.3635 332.66208 186.5996 333.26367 186.96484 C 334.91873 187.96967 334.56852 188.36093 335.03711 189.46875 C 335.5057 190.57657 335.97461 193.63867 335.97461 193.63867 C 335.97461 193.63867 336.00937 190.16462 335.55859 188.8418 C 335.10781 187.51898 335.10398 186.62965 333.47266 185.71484 C 331.84133 184.80003 330.51768 184.58186 328.7793 183.94141 C 327.04092 183.30096 324.76051 182.50042 323.35742 181.64844 C 321.95433 180.79646 320.33398 177.68555 320.33398 177.68555 z M 315.64062 178.83203 C 315.64062 178.83203 316.39829 181.3078 316.78906 182.37695 C 317.17983 183.4461 317.3603 184.65072 317.51758 185.81836 C 317.67486 186.986 317.73091 188.24884 317.72656 189.36328 C 317.72256 190.47772 317.51758 192.07509 317.51758 192.49219 C 317.51758 192.90929 318.33198 190.86766 318.56055 189.99023 C 318.78912 189.11281 318.89511 188.15673 318.87305 187.2793 C 318.85095 186.40187 318.64571 185.66317 318.45703 184.77539 C 318.26835 183.88761 318.26009 182.89377 317.72656 181.96094 C 317.19303 181.02811 315.64062 178.83203 315.64062 178.83203 z M 314.70312 180.08398 C 314.70313 180.08398 315.17317 184.82792 315.43359 186.86133 C 315.69402 188.89474 316.26758 192.91016 316.26758 192.91016 C 316.26758 192.91016 316.43363 188.48566 316.16211 186.44336 C 315.89058 184.40106 314.70312 180.08398 314.70312 180.08398 z M 313.03516 180.1875 C 313.03516 180.1875 312.23537 182.94791 312.20117 184.35938 C 312.16693 185.77084 312.38211 186.94491 312.82617 188.5293 C 313.27023 190.11369 315.01562 193.74414 315.01562 193.74414 C 315.01562 193.74414 313.77977 189.82417 313.45117 188.2168 C 313.12257 186.60943 312.99769 185.49264 312.92969 184.15039 C 312.86171 182.80814 313.03516 180.1875 313.03516 180.1875 z M 310.32422 181.54297 C 310.32422 181.54297 309.53245 184.04341 309.69727 185.29688 C 309.86209 186.55034 310.74023 189.46875 310.74023 189.46875 C 310.74023 189.46875 310.59688 186.71109 310.42773 185.50586 C 310.25855 184.30063 310.32422 181.54297 310.32422 181.54297 z M 320.75 184.35938 C 320.75 184.35938 321.59453 188.20561 321.68945 189.57227 C 321.78435 190.93892 321.58594 193.42969 321.58594 193.42969 C 321.58594 193.42969 322.62315 190.78158 322.52344 189.36328 C 322.42374 187.94498 320.75 184.35938 320.75 184.35938 z M 322.84375 185.43945 C 322.84375 185.43945 323.63694 187.80246 323.80273 188.75781 C 323.96852 189.71316 323.998 190.32458 323.94922 191.11719 C 323.90042 191.9098 323.50781 193.47656 323.50781 193.47656 C 323.50781 193.47656 324.50345 191.83076 324.65039 190.9707 C 324.79733 190.11064 324.70413 189.44823 324.42773 188.5 C 324.1513 187.55177 322.84375 185.43945 322.84375 185.43945 z M 328.66797 185.58789 C 328.66797 185.58789 329.54059 187.35675 329.81055 188.16797 C 330.08051 188.97919 330.32089 189.58775 330.47461 190.34375 C 330.62833 191.09975 330.73695 192.12223 330.73242 192.70312 C 330.72742 193.28402 330.62305 194.06641 330.62305 194.06641 C 330.62305 194.06641 330.9984 193.229 331.10156 192.5918 C 331.20472 191.9546 331.12798 190.83876 330.95312 190.04883 C 330.77828 189.2589 330.42161 188.63655 330.06836 187.87305 C 329.71511 187.10955 328.66797 185.58789 328.66797 185.58789 z M 324.71289 185.77734 C 324.71289 185.77734 325.58217 187.4742 325.83008 188.22852 C 326.07798 188.98283 326.21481 189.62102 326.25586 190.25391 C 326.29696 190.88679 326.24497 191.42274 326.12109 191.98438 C 325.99719 192.54602 325.52148 193.5918 325.52148 193.5918 C 325.52148 193.5918 326.26043 192.57773 326.45898 192.01172 C 326.65752 191.4457 326.71815 190.95481 326.70312 190.26758 C 326.68813 189.58035 326.60303 188.71683 326.27344 187.94531 C 325.94384 187.17378 324.71289 185.77734 324.71289 185.77734 z M 306.2168 185.91992 C 306.2168 185.91992 305.74081 188.23062 305.66406 189.34766 C 305.58726 190.4647 305.54624 191.86653 305.73633 192.5918 C 305.92642 193.31707 306.02304 193.40777 306.32617 193.69922 C 306.6293 193.99067 307.4707 194.25195 307.4707 194.25195 C 307.4707 194.25195 306.81346 193.80444 306.58398 193.47656 C 306.3545 193.14868 306.28646 193.03392 306.14258 192.33398 C 305.9987 191.63405 306.0212 190.34566 306.03125 189.27539 C 306.04125 188.20512 306.2168 185.91992 306.2168 185.91992 z M 326.66797 185.95117 C 326.66797 185.95117 327.50052 187.31892 327.73047 187.98438 C 327.96041 188.64984 328.02583 189.24123 328.08203 189.88086 C 328.13823 190.52048 328.12531 191.15158 328.06641 191.80469 C 328.00741 192.45779 327.72266 193.78516 327.72266 193.78516 C 327.72266 193.78516 328.4337 192.42122 328.58008 191.73242 C 328.72646 191.04362 328.69746 190.39219 328.62695 189.73242 C 328.55635 189.07264 328.4834 188.45934 328.16211 187.80664 C 327.84082 187.15395 326.66797 185.95117 326.66797 185.95117 z M 307.24805 186.32617 C 307.24805 186.32617 307.15296 188.94403 307.28516 189.97461 C 307.41732 191.00519 307.64481 191.78804 307.91211 192.48242 C 308.17941 193.1768 308.79688 194.14062 308.79688 194.14062 C 308.79688 194.14062 308.37094 193.00321 308.16992 192.29688 C 307.9689 191.59054 307.7827 190.89578 307.61719 189.90039 C 307.45168 188.905 307.24805 186.32617 307.24805 186.32617 z M 301.75586 188.42578 C 301.75586 188.42578 301.27196 190.37095 301.24023 191.30273 C 301.20853 192.23452 301.17735 193.19635 301.38672 193.91992 C 301.59611 194.64349 302.16016 195.43164 302.16016 195.43164 C 302.16016 195.43164 301.98562 194.67914 301.83008 193.95703 C 301.67454 193.23492 301.65946 192.26282 301.64453 191.33984 C 301.62963 190.41686 301.75586 188.42578 301.75586 188.42578 z M 289.67578 188.94727 C 289.67578 188.94727 288.23803 189.97665 287.69531 190.92773 C 287.15259 191.87882 286.79341 193.40185 286.75781 194.57812 C 286.72221 195.7544 287.38281 197.81055 287.38281 197.81055 C 287.38281 197.81055 287.23789 195.61287 287.38281 194.57812 C 287.52773 193.54338 287.83294 192.60245 288.2168 191.6582 C 288.60066 190.71395 289.67578 188.94727 289.67578 188.94727 z M 287.38281 189.46875 C 287.38281 189.46875 285.60556 191.33441 285.19336 192.2832 C 284.78126 193.23199 284.56152 193.90971 284.77539 194.89062 C 284.98926 195.87154 286.65234 197.70508 286.65234 197.70508 C 286.65234 197.70508 285.83065 195.83133 285.71484 194.89062 C 285.59903 193.94992 285.64984 193.10701 285.92188 192.17969 C 286.19391 191.25237 287.38281 189.46875 287.38281 189.46875 z M 296.33594 190.63867 C 296.33594 190.63867 295.71373 192.22349 295.63477 192.77734 C 295.55577 193.33119 295.60838 193.41202 295.67188 193.88281 C 295.73537 194.3536 296.07812 195.57812 296.07812 195.57812 C 296.07812 195.57812 295.96517 194.22885 295.9668 193.73633 C 295.9688 193.24381 295.98552 193.14611 296.04102 192.62891 C 296.09652 192.11171 296.33594 190.63867 296.33594 190.63867 z M 289.60938 191.08008 C 289.60938 191.08008 288.69458 193.78707 288.76953 194.68164 C 288.84453 195.57621 289.40039 197.60742 289.40039 197.60742 C 289.40039 197.60742 289.31151 195.48221 289.25977 194.5957 C 289.20797 193.70919 289.60938 191.08008 289.60938 191.08008 z M 293.69141 191.13672 C 293.69141 191.13672 293.07226 193.00005 293.01367 194.16016 C 292.95507 195.32027 293.11719 197.28906 293.11719 197.28906 C 293.11719 197.28906 293.44839 195.23893 293.53516 194.16016 C 293.62196 193.08139 293.69141 191.13672 293.69141 191.13672 z "/>
</g>`;


export enum FacialHairPlacement {
    UpperLip, Chin
}

class FacialHairItem {

    readonly id: FacialHairType;
    readonly category: FacialHairCategory;
    readonly svg: string;
    readonly name: string;

    constructor(id: FacialHairType, category: FacialHairCategory, name: string, svg: string) {
        this.id = id;
        this.category = category;
        this.name = name;
        this.svg = svg;
    }
}


class FacialHairCatalog {

    private static _instance: FacialHairCatalog;

    items = [
        new FacialHairItem(FacialHairType.NoMoustache, FacialHairCategory.Moustache, "None", ""),
        new FacialHairItem(FacialHairType.NoBeard, FacialHairCategory.Beard, "None", ""),
        new FacialHairItem(FacialHairType.SoulPatch, FacialHairCategory.Beard, "Soul Patch", SoulPatch),
        new FacialHairItem(FacialHairType.BasicMoustache, FacialHairCategory.Moustache, "Basic Moustach", BasicMoustache),
    ]

    public static get instance() {
        if (FacialHairCatalog._instance == null) {
            FacialHairCatalog._instance = new FacialHairCatalog();
        }
        return FacialHairCatalog._instance;
    }

    getFacialHair(token: Token, placement: FacialHairPlacement) {
        let result = "";
        this.items.forEach(i => {
            if (token.facialHairType.indexOf(i.id) >= 0) {
                if (placement === this.getPlacementForItem(i)) {
                    result += i.svg.replace(SpeciesRestrictions.DEFAULT_HAIR_COLOR_REGEX, token.hairColor);
                }
            }
        });
        return result;
    }

    getSwatches(token: Token, placement: FacialHairPlacement) {
        return this.items
            .filter(i => (placement === FacialHairPlacement.Chin && i.category === FacialHairCategory.Beard) ||
                (placement === FacialHairPlacement.UpperLip && i.category === FacialHairCategory.Moustache))
            .map(i => new Swatch(i.id, i.name, (token) => FacialHairCatalog.decorateSwatch(i.svg, token)));
    }

    private getPlacementForItem(item: FacialHairItem) {
        let category = item.category;
        return category === FacialHairCategory.Moustache ? FacialHairPlacement.UpperLip : FacialHairPlacement.Chin;
    }

    getPlacementFor(type: FacialHairType) {
        let item = this.items.filter(i => i.id === type)[0];
        return this.getPlacementForItem(item);
    }

    private static decorateSwatch(svg: string, token: Token) {
        let result = `<svg viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g transform="translate(-255, -140)">`
            + DefaultLip.replace(SpeciesRestrictions.DEFAULT_SKIN_COLOR_REGEX, "#ffffff")
            + svg.replace(SpeciesRestrictions.DEFAULT_HAIR_COLOR_REGEX, token.hairColor)
            + `</g>
            </svg>`;
        return result;
    }
}

export default FacialHairCatalog;